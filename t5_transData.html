<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Data Transformation with dplyr - Computation and Visualization in R</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="home.html">Home</a></li><li class="chapter-item expanded affix "><a href="dis.html">Disclaimer</a></li><li class="chapter-item expanded affix "><a href="faq.html">FAQ for the class</a></li><li class="chapter-item expanded "><a href="t1_basicR.html"><strong aria-hidden="true">1.</strong> Basic of R</a></li><li class="chapter-item expanded "><a href="t2_func.html"><strong aria-hidden="true">2.</strong> R Functions</a></li><li class="chapter-item expanded "><a href="t3_gramar.html"><strong aria-hidden="true">3.</strong> The Grammar of Graphics</a></li><li class="chapter-item expanded "><a href="t4_basicViz.html"><strong aria-hidden="true">4.</strong> Basic Data Visualization in R</a></li><li class="chapter-item expanded "><a href="t5_transData.html" class="active"><strong aria-hidden="true">5.</strong> Data Transformation with dplyr</a></li><li class="chapter-item expanded "><a href="t6_dataWrangling_trt.html"><strong aria-hidden="true">6.</strong> Data Wrangling with tibbles, readr and tidyr</a></li><li class="chapter-item expanded "><a href="t7_dataWrangling_sf.html"><strong aria-hidden="true">7.</strong> (optional) Data Wrangling with stringr, forcats</a></li><li class="chapter-item expanded "><a href="t8_relational.html"><strong aria-hidden="true">8.</strong> Visualizing Relational Data</a></li><li class="chapter-item expanded "><a href="t9_shiny.html"><strong aria-hidden="true">9.</strong> Introduction to Shiny</a></li><li class="chapter-item expanded "><a href="t10_eda.html"><strong aria-hidden="true">10.</strong> Exploratory Data Analysis and More Data Visualization</a></li><li class="chapter-item expanded "><a href="additional.html"><strong aria-hidden="true">11.</strong> Additional R Workshop</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Computation and Visualization in R</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/zhenyuanlu/r-comput-viz" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="data-transformation-with-dplyr"><a class="header" href="#data-transformation-with-dplyr">Data Transformation with dplyr</a></h1>
<p>Often you’ll need to create some new variables or summaries, or maybe you just want to rename the variables or reorder the observations in order to make the data a little easier to work with.</p>
<pre><code class="language-r"># Needed libraries ----
library(nycflights13)
library(dplyr)
#or ----
library(tidyverse)
</code></pre>
<p align="center">
  <img src="images/t5/1.png" style="width:100%"/>
</p>
<p>The conflict message tells you some of the other functions have been overwrited by Tidyverse. If you want to use the base version of these functions after loading dplyr, you’ll need to use their full names: stats::filter() and stats::lag(),etc.</p>
<h2 id="search"><a class="header" href="#search"><code>search()</code></a></h2>
<pre><code class="language-r">search()
</code></pre>
<pre><code>##  [1] &quot;.GlobalEnv&quot;           &quot;package:forcats&quot;      &quot;package:stringr&quot;
##  [4] &quot;package:dplyr&quot;        &quot;package:purrr&quot;        &quot;package:readr&quot;
##  [7] &quot;package:tidyr&quot;        &quot;package:tibble&quot;       &quot;package:ggplot2&quot;
## [10] &quot;package:tidyverse&quot;    &quot;package:nycflights13&quot; &quot;package:stats&quot;
## [13] &quot;package:graphics&quot;     &quot;package:grDevices&quot;    &quot;package:utils&quot;
## [16] &quot;package:datasets&quot;     &quot;package:methods&quot;      &quot;Autoloads&quot;
## [19] &quot;package:base&quot;
</code></pre>
<p>You may use the full syntax <code>package::function_name()</code> to load the specific function, if there are any overwriting issues occured.</p>
<h2 id="package-nycflights13"><a class="header" href="#package-nycflights13">Package <code>nycflights13</code></a></h2>
<p>To explore the basic data manipulation verbs of dplyr, we’ll use nycflights13::flights. This data frame contains all 336,776 flights that departed from New York City in 2013:</p>
<pre><code class="language-r">head(flights)
</code></pre>
<pre><code>## # A tibble: 6 × 19
##    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
## 1  2013     1     1      517            515         2      830            819
## 2  2013     1     1      533            529         4      850            830
## 3  2013     1     1      542            540         2      923            850
## 4  2013     1     1      544            545        -1     1004           1022
## 5  2013     1     1      554            600        -6      812            837
## 6  2013     1     1      554            558        -4      740            728
## # … with 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
</code></pre>
<h3 id="interview-data-with-view"><a class="header" href="#interview-data-with-view">Interview data with <code>view()</code></a></h3>
<pre><code class="language-r">view(flights)
</code></pre>
<p>You might also have noticed the row of three- (or four-) letter abbreviations under the column names. These describe the type of each variable:</p>
<ul>
<li><strong>int</strong> stands for integers.</li>
<li><strong>dbl</strong> stands for doubles, or real numbers.</li>
<li><strong>chr</strong> stands for character vectors, or strings.</li>
<li><strong>dttm</strong> stands for date-times (a date + a time).</li>
</ul>
<p><strong>Flights actually is a tibble, a special type of <code>data.frame</code>. We will talk about it later.</strong></p>
<p>There are three other common types of variables that aren’t used in this dataset but you’ll encounter later.</p>
<ul>
<li><strong>lgl</strong> stands for logical, vectors that contain only TRUE or FALSE.</li>
<li><strong>fctr</strong> stands for factors, which R uses to represent categorical variables with fixed possible values.</li>
<li><strong>date</strong> stands for dates.</li>
</ul>
<h2 id="dplyr"><a class="header" href="#dplyr"><code>dplyr</code></a></h2>
<p>You are going to learn the five key <code>dplyr</code> functions that allow you to solve the vast majority of your data-manipulation challenges:</p>
<ul>
<li><code>filter()</code> pick observations by their values .</li>
<li><code>arrange()</code> Reorder the rows.</li>
<li><code>select()</code> Pick variables by their names.</li>
<li><code>mutate()</code> Create new variables with functions of existing variables.</li>
<li><code>summarize()</code> Collapse many values down to a single summary.</li>
<li><code>group_by()</code> Conjunction.</li>
</ul>
<h3 id="dplyr-grammar"><a class="header" href="#dplyr-grammar"><code>dplyr</code> grammar</a></h3>
<p>All verbs work similarly: <code>filter(df, argument,...)</code></p>
<ol>
<li>The first argument is a data frame.</li>
<li>The subsequent arguments describe what to do with the data frame, using the variable names (without quotes).</li>
<li>The result is a new data frame.</li>
</ol>
<h2 id="filter"><a class="header" href="#filter"><code>filter()</code></a></h2>
<h4 id="filter-rows-with-filter"><a class="header" href="#filter-rows-with-filter">Filter rows with <code>filter()</code></a></h4>
<p>filter() allows you to subset observations based on their values.</p>
<p>Base function in R:</p>
<pre><code class="language-r">flights[flights$month==1&amp;flights$day==1,]
</code></pre>
<p><code>filter() </code>function in dplyr:</p>
<pre><code class="language-r">filter(flights, month==1,day==1)
</code></pre>
<p>We only want to see the Jan.1st flights</p>
<pre><code class="language-r">jan &lt;- filter(flights, month==1, day==1)
jan
</code></pre>
<pre><code>## # A tibble: 842 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # … with 832 more rows, and 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
## #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
</code></pre>
<h3 id="filter-rows-with-filter-examples"><a class="header" href="#filter-rows-with-filter-examples">Filter rows with <code>filter()</code>: examples</a></h3>
<pre><code class="language-r">dec25 &lt;- filter(flights, month == 12, day == 25)
dec25
</code></pre>
<pre><code>## # A tibble: 719 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013    12    25      456            500        -4      649            651
##  2  2013    12    25      524            515         9      805            814
##  3  2013    12    25      542            540         2      832            850
##  4  2013    12    25      546            550        -4     1022           1027
##  5  2013    12    25      556            600        -4      730            745
##  6  2013    12    25      557            600        -3      743            752
##  7  2013    12    25      557            600        -3      818            831
##  8  2013    12    25      559            600        -1      855            856
##  9  2013    12    25      559            600        -1      849            855
## 10  2013    12    25      600            600         0      850            846
## # … with 709 more rows, and 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
## #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
</code></pre>
<h4 id="filter---comparison"><a class="header" href="#filter---comparison"><code>filter()</code> - comparison</a></h4>
<p>To use filtering effectively, you have to know how to select the observations that you want using the comparison operators.</p>
<p>R provides the standard suite: <code>&gt;, &gt;=, &lt;, &lt;=, != (not equal), and == (equal)</code>.</p>
<p><strong>Flights on Feb~Dec, and before 28 th</strong></p>
<pre><code class="language-r">filter(flights, month&gt;1&amp;!day&gt;28)
</code></pre>
<p><strong>Flights on Feb~Dec, and before 28 th</strong></p>
<pre><code class="language-r">flights28 &lt;- filter(flights, month&gt;1&amp;!day&gt;28)
flights28
</code></pre>
<pre><code>## # A tibble: 285,972 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013    10     1      447            500       -13      614            648
##  2  2013    10     1      522            517         5      735            757
##  3  2013    10     1      536            545        -9      809            855
##  4  2013    10     1      539            545        -6      801            827
##  5  2013    10     1      539            545        -6      917            933
##  6  2013    10     1      544            550        -6      912            932
##  7  2013    10     1      549            600       -11      653            716
##  8  2013    10     1      550            600       -10      648            700
##  9  2013    10     1      550            600       -10      649            659
## 10  2013    10     1      551            600        -9      727            730
## # … with 285,962 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
</code></pre>
<blockquote>
<h3 id="tips"><a class="header" href="#tips">Tips</a></h3>
<p>When you’re starting out with R,
the easiest mistake to make is to use <code>=</code> instead of <code>==</code> when testing for equality.
When this happens you’ll get an informative error:</p>
<pre><code class="language-r">filter(flights, month = 1)
</code></pre>
<pre><code>## Error in `filter()`:
## ! We detected a named input.
## ℹ This usually means that you've used `=` instead of `==`.
## ℹ Did you mean `month == 1`?
</code></pre>
<p>There’s another common problem you might encounter when using <code>==</code>: floating-point numbers.</p>
<pre><code class="language-r">sqrt(2)^2==2
</code></pre>
<pre><code>## [1] FALSE
</code></pre>
<pre><code class="language-r">1/49*49==1
</code></pre>
<pre><code>## [1] FALSE
</code></pre>
<p>Computers use finite precision arithmetic (they obviously can’t store an infinite number of digits!)
so remember that every number you see is an <strong>approximation</strong>. Instead of relying on <code>==</code>, use n<code>ear()</code>:</p>
<pre><code class="language-r">near(sqrt(2) ^ 2, 2)
</code></pre>
<pre><code>## [1] TRUE
</code></pre>
<pre><code class="language-r">near(1 / 49 * 49, 1)
</code></pre>
<pre><code>## [1] TRUE
</code></pre>
</blockquote>
<h2 id="logical-operators"><a class="header" href="#logical-operators">Logical operators</a></h2>
<p align="center">
  <img src="images/t5/2.png" style="width:80%"/>
</p>
<h2 id="nycflights13-flights-on-may-or-june"><a class="header" href="#nycflights13-flights-on-may-or-june">nycflights13: Flights on May or June</a></h2>
<pre><code class="language-r">mayJune &lt;- filter(flights, month==5|month==6)
mayJune$month %&gt;% unique()
</code></pre>
<pre><code>## [1] 5 6
</code></pre>
<blockquote>
<h3 id="tips-in"><a class="header" href="#tips-in">Tips: %in%</a></h3>
<p>A useful shorthand for this problem is x %in% y. This will select every row where x is one of the values in y. We could use it to rewrite the preceding code:
Retrieve the flights information on Jan, Feb, and Mar</p>
<pre><code class="language-r">filter(flights, month%in%c(1,2,3)) %&gt;% head()
</code></pre>
</blockquote>
<h3 id="-not-equals-to"><a class="header" href="#-not-equals-to"><code>!=</code> not equals to</a></h3>
<p>Flights not on Feb</p>
<pre><code class="language-r">filter(flights, month!=2)
</code></pre>
<pre><code>## # A tibble: 311,825 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # … with 311,815 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
</code></pre>
<h3 id="--and-"><a class="header" href="#--and-">|, &amp;, and &quot;,&quot;</a></h3>
<p>Compare the following three code chunks</p>
<pre><code class="language-r">filter(flights, !(arr_delay &gt; 120 | dep_delay &gt; 120)) %&gt;%
  select(dep_delay) %&gt;% head(3)
</code></pre>
<pre><code class="language-r">filter(flights, arr_delay &lt;= 120, dep_delay &lt;= 120) %&gt;%
  select(dep_delay) %&gt;% head(3)
</code></pre>
<pre><code class="language-r">filter(flights, !arr_delay &gt; 120 &amp; !dep_delay &gt; 120) %&gt;%
  select(dep_delay) %&gt;% head(3)
</code></pre>
<pre><code class="language-r">## # A tibble: 3 × 1
##   dep_delay
##       &lt;dbl&gt;
## 1         2
## 2         4
## 3         2
</code></pre>
<h3 id="missing-values"><a class="header" href="#missing-values">Missing Values</a></h3>
<p>One important feature of R that can make comparison tricky is missing values, or NAs (“not availables”).</p>
<pre><code class="language-r">NA&gt;5
</code></pre>
<pre><code>## [1] NA
</code></pre>
<pre><code class="language-r">NA==10
</code></pre>
<pre><code>## [1] NA
</code></pre>
<pre><code class="language-r">NA+10
</code></pre>
<pre><code>## [1] NA
</code></pre>
<pre><code class="language-r">NA/2
</code></pre>
<h2 id="1-na"><a class="header" href="#1-na">[1] NA</a></h2>
<pre><code>
### NA==NA

The most confusing result is this one:

```r
NA==NA
</code></pre>
<pre><code>## [1] NA
</code></pre>
<p>But we can understand it easily in one example:</p>
<pre><code class="language-r"># Let ZAge be Zhenyuan's age. We don't know how old he is.
ZAge &lt;- NA
# Let TAge be one random Tub's age. We don't know how old they is. (Pretty sure we don't know a random Tub's age...)
TAge &lt;- NA
# Are Zhenyuan and Tub the same age?
ZAge == TAge
</code></pre>
<pre><code>## [1] NA
# We don't know!
</code></pre>
<h3 id="na-with-filter"><a class="header" href="#na-with-filter">NA with <code>filter()</code></a></h3>
<p><code>filter()</code> only includes rows where the condition is TRUE;
it excludes both FALSE and NA values.
If you want to preserve missing values, ask for them explicitly:</p>
<pre><code class="language-r">df &lt;- tibble(x = c(1, NA, 3))
filter(df, x &gt; 1)
</code></pre>
<pre><code>## # A tibble: 1 × 1
##       x
##   &lt;dbl&gt;
## 1     3
</code></pre>
<pre><code class="language-r">filter(df, is.na(x) | x &gt; 1)
</code></pre>
<pre><code>## # A tibble: 2 × 1
##       x
##   &lt;dbl&gt;
## 1    NA
## 2     3
</code></pre>
<h3 id="some-other-functions"><a class="header" href="#some-other-functions">Some other functions</a></h3>
<pre><code class="language-r">is.na(NA)
</code></pre>
<pre><code class="language-r">## [1] TRUE
</code></pre>
<pre><code class="language-r">df &lt;- data.frame(A=c(1,NA,2))

na.omit(df)
</code></pre>
<pre><code>##   A
## 1 1
## 3 2
</code></pre>
<pre><code class="language-r">sum(df[,1], na.rm=T)
</code></pre>
<pre><code>## [1] 3
</code></pre>
<blockquote>
<h3 id="exercise-1"><a class="header" href="#exercise-1">Exercise 1</a></h3>
<p>Find all flights that:</p>
<ol>
<li>
<p>Flew to Houston (IAH)</p>
</li>
<li>
<p>Were operated by United (UA), American (AA), or Delta (DL)</p>
</li>
<li>
<p>Departed in summer (July, August, and September)</p>
</li>
</ol>
</blockquote>
<blockquote>
<h3 id="exercise-2"><a class="header" href="#exercise-2">Exercise 2</a></h3>
<p>Use data set <strong>msleep</strong>, and create a new data frame of mammals with feeding type <strong>carnivore</strong> and brain weight less than the average of brain weight over all mammals. Make sure no NA values in column of brain weight.</p>
</blockquote>
<h2 id="arrange"><a class="header" href="#arrange"><code>arrange()</code></a></h2>
<h3 id="arrange-rows-with-arrange"><a class="header" href="#arrange-rows-with-arrange">Arrange Rows with arrange()</a></h3>
<p><code>arrange()</code> works similarly to <code>filter()</code> except that instead of selecting rows, it changes their order</p>
<p><strong>Base function in R:</strong></p>
<pre><code class="language-r">flights[order(flights$year,flights$month, flights$day, decreasing=F),]
</code></pre>
<p><strong><code>arrange()</code> function in dplyr:</strong></p>
<pre><code class="language-r">arrange(flights, year, month, day)
</code></pre>
<pre><code>## # A tibble: 336,776 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # … with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
</code></pre>
<h4 id="use-desc-to-reorder-by-a-column-in-descending-order"><a class="header" href="#use-desc-to-reorder-by-a-column-in-descending-order">Use <code>desc()</code> to reorder by a column in descending order</a></h4>
<pre><code class="language-r">arrange(flights, desc(arr_delay))
</code></pre>
<pre><code>## # A tibble: 336,776 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     9      641            900      1301     1242           1530
##  2  2013     6    15     1432           1935      1137     1607           2120
##  3  2013     1    10     1121           1635      1126     1239           1810
##  4  2013     9    20     1139           1845      1014     1457           2210
##  5  2013     7    22      845           1600      1005     1044           1815
##  6  2013     4    10     1100           1900       960     1342           2211
##  7  2013     3    17     2321            810       911      135           1020
##  8  2013     7    22     2257            759       898      121           1026
##  9  2013    12     5      756           1700       896     1058           2020
## 10  2013     5     3     1133           2055       878     1250           2215
## # … with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
</code></pre>
<h4 id="missing-values-are-always-sorted-at-the-end"><a class="header" href="#missing-values-are-always-sorted-at-the-end">Missing values are always sorted at the end</a></h4>
<pre><code class="language-r">df &lt;- data.frame(x = c(5, 2, NA))
arrange(df, x) #or arrange(df, desc(x))
</code></pre>
<pre><code>##    x
## 1  2
## 2  5
## 3 NA
</code></pre>
<blockquote>
<h3 id="exercises"><a class="header" href="#exercises">Exercises</a></h3>
<ol>
<li>Sort flights to find the most delayed flights. Find the flights that left earliest.</li>
<li>Sort flights to find the fastest flights.</li>
</ol>
</blockquote>
<h2 id="select"><a class="header" href="#select"><code>select()</code></a></h2>
<h4 id="select-columns-with-select"><a class="header" href="#select-columns-with-select">Select Columns with <code>select()</code></a></h4>
<p><code>select()</code> allows you to rapidly zoom in on a useful subset using operations based on the names of the variables.</p>
<p><strong>Base function in R:</strong></p>
<pre><code class="language-r"># Select columns by name
flights[,c(&quot;year&quot;,&quot;month&quot;,&quot;day&quot;)]
</code></pre>
<p><strong>select() function in dplyr:</strong></p>
<pre><code class="language-r"># Select columns by name
select(flights, year, month, day)
</code></pre>
<pre><code>## # A tibble: 336,776 × 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # … with 336,766 more rows
</code></pre>
<h4 id="select-all-colums-between-year-and-day"><a class="header" href="#select-all-colums-between-year-and-day">Select all colums between year and day</a></h4>
<pre><code class="language-r">select(flights, year:day)
</code></pre>
<pre><code>## # A tibble: 336,776 × 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # … with 336,766 more rows
</code></pre>
<h3 id="select-all-columns-except-those-from-year-to-day"><a class="header" href="#select-all-columns-except-those-from-year-to-day">Select all columns except those from year to day</a></h3>
<pre><code class="language-r">select(flights, -(year:day))
</code></pre>
<pre><code>## # A tibble: 336,776 × 16
##    dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier
##       &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;
##  1      517            515         2      830            819        11 UA
##  2      533            529         4      850            830        20 UA
##  3      542            540         2      923            850        33 AA
##  4      544            545        -1     1004           1022       -18 B6
##  5      554            600        -6      812            837       -25 DL
##  6      554            558        -4      740            728        12 UA
##  7      555            600        -5      913            854        19 B6
##  8      557            600        -3      709            723       -14 EV
##  9      557            600        -3      838            846        -8 B6
## 10      558            600        -2      753            745         8 AA
## # … with 336,766 more rows, and 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
</code></pre>
<h4 id="other-arguments-within-select"><a class="header" href="#other-arguments-within-select">Other arguments within <code>select()</code></a></h4>
<p>There are a number of helper functions you can use within <code>select()</code>:</p>
<ul>
<li><code>starts_with(&quot;abc&quot;)</code> matches names that begin with “abc”.</li>
<li><code>ends_with(&quot;xyz&quot;)</code> matches names that end with “xyz”.</li>
<li><code>contains(&quot;ijk&quot;)</code> matches names that contain “ijk”.</li>
<li><code>matches(&quot;^a&quot;)</code> selects variables that match a regular expression. (check <strong>R4DS &quot;regular expressions&quot;</strong>)</li>
<li><code>num_range(&quot;x&quot;, 1:3)</code> matches x1, x2, and x3.</li>
</ul>
<h4 id="select-examples"><a class="header" href="#select-examples"><code>select()</code>: examples</a></h4>
<pre><code class="language-r">abc.df &lt;- data.frame(apple=c(&quot;b&quot;, &quot;c&quot;), an.orange=1:2, orange1=2:3)
abc.df
</code></pre>
<pre><code>##   apple an.orange orange1
## 1     b         1       2
## 2     c         2       3
</code></pre>
<pre><code class="language-r">select(abc.df, starts_with(&quot;app&quot;))
</code></pre>
<pre><code>##   apple
## 1     b
## 2     c
</code></pre>
<pre><code class="language-r">select(abc.df, ends_with(&quot;ge&quot;))
</code></pre>
<pre><code>##   an.orange
## 1         1
## 2         2
</code></pre>
<pre><code class="language-r">select(abc.df, contains(&quot;pp&quot;))
</code></pre>
<pre><code>##   apple
## 1     b
## 2     c
</code></pre>
<pre><code class="language-r">select(abc.df, matches(&quot;^a&quot;))
</code></pre>
<pre><code>##   apple an.orange
## 1     b         1
## 2     c         2
</code></pre>
<pre><code class="language-r">select(abc.df, num_range(&quot;orange&quot;, 1))
</code></pre>
<pre><code>##   orange1
## 1       2
## 2       3
</code></pre>
<h2 id="mutate"><a class="header" href="#mutate"><code>mutate()</code></a></h2>
<h4 id="add-new-variables-with-mutate"><a class="header" href="#add-new-variables-with-mutate">Add New Variables with mutate()</a></h4>
<h4 id="references"><a class="header" href="#references">References</a></h4>
<p>[1] <a href="https://r4ds.had.co.nz/">Hadley Wickham, Garrett Grolemund. R For Data Science.</a> \</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="t4_basicViz.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="t6_dataWrangling_trt.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="t4_basicViz.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="t6_dataWrangling_trt.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script type="text/javascript">
            window.playground_copyable = true;
        </script>

        <script src="ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>

        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
